CSV, with and without headers
=============================

Headerless CSV on input or output
----------------------------------------------------------------

Sometimes we get CSV files which lack a header. For example (`data/headerless.csv <./data/headerless.csv>`_):

POKI_RUN_COMMAND
cat data/headerless.csv
POKI_EOF

You can use Miller to add a header. The ``--implicit-csv-header`` applies positionally indexed labels:

POKI_RUN_COMMAND
mlr --csv --implicit-csv-header cat data/headerless.csv
POKI_EOF

Following that, you can rename the positionally indexed labels to names with meaning for your context.  For example:

POKI_RUN_COMMAND
mlr --csv --implicit-csv-header label name,age,status data/headerless.csv
POKI_EOF

Likewise, if you need to produce CSV which is lacking its header, you can pipe Miller's output to the system command ``sed 1d``, or you can use Miller's ``--headerless-csv-output`` option:

POKI_RUN_COMMAND
head -5 data/colored-shapes.dkvp | mlr --ocsv cat
POKI_EOF

POKI_RUN_COMMAND
head -5 data/colored-shapes.dkvp | mlr --ocsv --headerless-csv-output cat
POKI_EOF

Lastly, often we say "CSV" or "TSV" when we have positionally indexed data in columns which are separated by commas or tabs, respectively. In this case it's perhaps simpler to **just use NIDX format** which was designed for this purpose. (See also :doc:`file-formats`.) For example:

POKI_RUN_COMMAND
mlr --inidx --ifs comma --oxtab cut -f 1,3 data/headerless.csv
POKI_EOF

Regularizing ragged CSV
----------------------------------------------------------------

Miller handles compliant CSV: in particular, it's an error if the number of data fields in a given data line don't match the number of header lines. But in the event that you have a CSV file in which some lines have less than the full number of fields, you can use Miller to pad them out. The trick is to use NIDX format, for which each line stands on its own without respect to a header line.

POKI_RUN_COMMAND
cat data/ragged.csv
POKI_EOF

POKI_INCLUDE_AND_RUN_ESCAPED(data/ragged-csv.sh)

or, more simply,

POKI_INCLUDE_AND_RUN_ESCAPED(data/ragged-csv-2.sh)
