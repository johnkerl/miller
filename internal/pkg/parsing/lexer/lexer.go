// Code generated by gocc; DO NOT EDIT.

package lexer

import (
	"io/ioutil"
	"unicode/utf8"

	"github.com/johnkerl/miller/internal/pkg/parsing/token"
)

const (
	NoState    = -1
	NumStates  = 328
	NumSymbols = 580
)

type Lexer struct {
	src     []byte
	pos     int
	line    int
	column  int
	Context token.Context
}

func NewLexer(src []byte) *Lexer {
	lexer := &Lexer{
		src:     src,
		pos:     0,
		line:    1,
		column:  1,
		Context: nil,
	}
	return lexer
}

// SourceContext is a simple instance of a token.Context which
// contains the name of the source file.
type SourceContext struct {
	Filepath string
}

func (s *SourceContext) Source() string {
	return s.Filepath
}

func NewLexerFile(fpath string) (*Lexer, error) {
	src, err := ioutil.ReadFile(fpath)
	if err != nil {
		return nil, err
	}
	lexer := NewLexer(src)
	lexer.Context = &SourceContext{Filepath: fpath}
	return lexer, nil
}

func (l *Lexer) Scan() (tok *token.Token) {
	tok = &token.Token{}
	if l.pos >= len(l.src) {
		tok.Type = token.EOF
		tok.Pos.Offset, tok.Pos.Line, tok.Pos.Column = l.pos, l.line, l.column
		tok.Pos.Context = l.Context
		return
	}
	start, startLine, startColumn, end := l.pos, l.line, l.column, 0
	tok.Type = token.INVALID
	state, rune1, size := 0, rune(-1), 0
	for state != -1 {
		if l.pos >= len(l.src) {
			rune1 = -1
		} else {
			rune1, size = utf8.DecodeRune(l.src[l.pos:])
			l.pos += size
		}

		nextState := -1
		if rune1 != -1 {
			nextState = TransTab[state](rune1)
		}
		state = nextState

		if state != -1 {

			switch rune1 {
			case '\n':
				l.line++
				l.column = 1
			case '\r':
				l.column = 1
			case '\t':
				l.column += 4
			default:
				l.column++
			}

			switch {
			case ActTab[state].Accept != -1:
				tok.Type = ActTab[state].Accept
				end = l.pos
			case ActTab[state].Ignore != "":
				start, startLine, startColumn = l.pos, l.line, l.column
				state = 0
				if start >= len(l.src) {
					tok.Type = token.EOF
				}

			}
		} else {
			if tok.Type == token.INVALID {
				end = l.pos
			}
		}
	}
	if end > start {
		l.pos = end
		tok.Lit = l.src[start:end]
	} else {
		tok.Lit = []byte{}
	}
	tok.Pos.Offset, tok.Pos.Line, tok.Pos.Column = start, startLine, startColumn
	tok.Pos.Context = l.Context

	return
}

func (l *Lexer) Reset() {
	l.pos = 0
}

/*
Lexer symbols:
0: '"'
1: '"'
2: '"'
3: '"'
4: 'i'
5: '0'
6: 'x'
7: '0'
8: 'o'
9: '0'
10: 'b'
11: '.'
12: '.'
13: '-'
14: '.'
15: '.'
16: '-'
17: '.'
18: '.'
19: '-'
20: 'M'
21: '_'
22: 'P'
23: 'I'
24: 'M'
25: '_'
26: 'E'
27: 'n'
28: 'u'
29: 'l'
30: 'l'
31: 'I'
32: 'n'
33: 'f'
34: 'N'
35: 'a'
36: 'N'
37: 'I'
38: 'P'
39: 'S'
40: 'I'
41: 'F'
42: 'S'
43: 'I'
44: 'R'
45: 'S'
46: 'O'
47: 'P'
48: 'S'
49: 'O'
50: 'F'
51: 'S'
52: 'O'
53: 'R'
54: 'S'
55: 'F'
56: 'L'
57: 'A'
58: 'T'
59: 'S'
60: 'E'
61: 'P'
62: 'N'
63: 'F'
64: 'N'
65: 'R'
66: 'F'
67: 'N'
68: 'R'
69: 'F'
70: 'I'
71: 'L'
72: 'E'
73: 'N'
74: 'A'
75: 'M'
76: 'E'
77: 'F'
78: 'I'
79: 'L'
80: 'E'
81: 'N'
82: 'U'
83: 'M'
84: 'E'
85: 'N'
86: 'V'
87: 'b'
88: 'e'
89: 'g'
90: 'i'
91: 'n'
92: 'd'
93: 'o'
94: 'e'
95: 'l'
96: 'i'
97: 'f'
98: 'e'
99: 'l'
100: 's'
101: 'e'
102: 'e'
103: 'n'
104: 'd'
105: 'f'
106: 'i'
107: 'l'
108: 't'
109: 'e'
110: 'r'
111: 'f'
112: 'o'
113: 'r'
114: 'i'
115: 'f'
116: 'i'
117: 'n'
118: 'w'
119: 'h'
120: 'i'
121: 'l'
122: 'e'
123: 'b'
124: 'r'
125: 'e'
126: 'a'
127: 'k'
128: 'c'
129: 'o'
130: 'n'
131: 't'
132: 'i'
133: 'n'
134: 'u'
135: 'e'
136: 'r'
137: 'e'
138: 't'
139: 'u'
140: 'r'
141: 'n'
142: 'f'
143: 'u'
144: 'n'
145: 'c'
146: 's'
147: 'u'
148: 'b'
149: 'r'
150: 'c'
151: 'a'
152: 'l'
153: 'l'
154: 'a'
155: 'r'
156: 'r'
157: 'b'
158: 'o'
159: 'o'
160: 'l'
161: 'f'
162: 'l'
163: 'o'
164: 'a'
165: 't'
166: 'i'
167: 'n'
168: 't'
169: 'm'
170: 'a'
171: 'p'
172: 'n'
173: 'u'
174: 'm'
175: 's'
176: 't'
177: 'r'
178: 'v'
179: 'a'
180: 'r'
181: 'f'
182: 'u'
183: 'n'
184: 'c'
185: 't'
186: 'u'
187: 'n'
188: 's'
189: 'e'
190: 't'
191: 'd'
192: 'u'
193: 'm'
194: 'p'
195: 'e'
196: 'd'
197: 'u'
198: 'm'
199: 'p'
200: 'e'
201: 'm'
202: 'i'
203: 't'
204: '1'
205: 'e'
206: 'm'
207: 'i'
208: 't'
209: 'e'
210: 'm'
211: 'i'
212: 't'
213: 'p'
214: 'e'
215: 'm'
216: 'i'
217: 't'
218: 'f'
219: 'e'
220: 'p'
221: 'r'
222: 'i'
223: 'n'
224: 't'
225: 'e'
226: 'p'
227: 'r'
228: 'i'
229: 'n'
230: 't'
231: 'n'
232: 'p'
233: 'r'
234: 'i'
235: 'n'
236: 't'
237: 'p'
238: 'r'
239: 'i'
240: 'n'
241: 't'
242: 'n'
243: 't'
244: 'e'
245: 'e'
246: 's'
247: 't'
248: 'd'
249: 'o'
250: 'u'
251: 't'
252: 's'
253: 't'
254: 'd'
255: 'e'
256: 'r'
257: 'r'
258: '$'
259: '$'
260: '{'
261: '}'
262: '$'
263: '*'
264: '@'
265: '@'
266: '{'
267: '}'
268: '@'
269: '*'
270: 'a'
271: 'l'
272: 'l'
273: '%'
274: '%'
275: '%'
276: 'p'
277: 'a'
278: 'n'
279: 'i'
280: 'c'
281: '%'
282: '%'
283: '%'
284: ';'
285: '{'
286: '}'
287: '='
288: '>'
289: '>'
290: '>'
291: '|'
292: ','
293: '('
294: ')'
295: '$'
296: '['
297: ']'
298: '$'
299: '['
300: '['
301: '$'
302: '['
303: '['
304: '['
305: '@'
306: '['
307: '|'
308: '|'
309: '='
310: '^'
311: '^'
312: '='
313: '&'
314: '&'
315: '='
316: '?'
317: '?'
318: '='
319: '?'
320: '?'
321: '?'
322: '='
323: '|'
324: '='
325: '&'
326: '='
327: '^'
328: '='
329: '<'
330: '<'
331: '='
332: '>'
333: '>'
334: '='
335: '>'
336: '>'
337: '>'
338: '='
339: '+'
340: '='
341: '.'
342: '='
343: '-'
344: '='
345: '*'
346: '='
347: '/'
348: '='
349: '/'
350: '/'
351: '='
352: '%'
353: '='
354: '*'
355: '*'
356: '='
357: '?'
358: ':'
359: '|'
360: '|'
361: '^'
362: '^'
363: '&'
364: '&'
365: '?'
366: '?'
367: '?'
368: '?'
369: '?'
370: '='
371: '~'
372: '!'
373: '='
374: '~'
375: '='
376: '='
377: '!'
378: '='
379: '<'
380: '='
381: '>'
382: '>'
383: '='
384: '<'
385: '<'
386: '='
387: '^'
388: '&'
389: '<'
390: '<'
391: '>'
392: '>'
393: '>'
394: '+'
395: '-'
396: '.'
397: '+'
398: '.'
399: '-'
400: '*'
401: '/'
402: '/'
403: '/'
404: '%'
405: '.'
406: '*'
407: '.'
408: '/'
409: '.'
410: '/'
411: '/'
412: '.'
413: '!'
414: '~'
415: '*'
416: '*'
417: '['
418: '['
419: '['
420: '['
421: '['
422: '['
423: '_'
424: '_'
425: ' '
426: '!'
427: '#'
428: '$'
429: '%'
430: '&'
431: '''
432: '\'
433: '('
434: ')'
435: '*'
436: '+'
437: ','
438: '-'
439: '.'
440: '/'
441: ':'
442: ';'
443: '<'
444: '='
445: '>'
446: '?'
447: '@'
448: '['
449: ']'
450: '^'
451: '_'
452: '`'
453: '{'
454: '|'
455: '}'
456: '~'
457: '\'
458: '\'
459: '\'
460: '"'
461: '\'
462: '['
463: '\'
464: ']'
465: '\'
466: 'b'
467: '\'
468: 'f'
469: '\'
470: 'n'
471: '\'
472: 'r'
473: '\'
474: 't'
475: '\'
476: 'x'
477: '\'
478: 'a'
479: '\'
480: 'v'
481: '\'
482: 'u'
483: '\'
484: 'U'
485: '\'
486: '.'
487: '\'
488: '*'
489: '\'
490: '0'
491: '\'
492: '1'
493: '\'
494: '2'
495: '\'
496: '3'
497: '\'
498: '4'
499: '\'
500: '5'
501: '\'
502: '6'
503: '\'
504: '7'
505: '\'
506: '8'
507: '\'
508: '9'
509: 'e'
510: 'E'
511: 't'
512: 'r'
513: 'u'
514: 'e'
515: 'f'
516: 'a'
517: 'l'
518: 's'
519: 'e'
520: ' '
521: '!'
522: '#'
523: '$'
524: '%'
525: '&'
526: '''
527: '\'
528: '('
529: ')'
530: '*'
531: '+'
532: ','
533: '-'
534: '.'
535: '/'
536: ':'
537: ';'
538: '<'
539: '='
540: '>'
541: '?'
542: '@'
543: '['
544: ']'
545: '^'
546: '_'
547: '`'
548: '|'
549: '~'
550: '\'
551: '{'
552: '\'
553: '}'
554: ' '
555: '\t'
556: '\n'
557: '\r'
558: '#'
559: '\n'
560: 'a'-'z'
561: 'A'-'Z'
562: \u00a0-\u00ff
563: \u0100-\U0010ffff
564: '0'-'9'
565: '0'-'9'
566: 'a'-'f'
567: 'A'-'F'
568: '0'-'7'
569: '0'-'1'
570: 'A'-'Z'
571: 'a'-'z'
572: '0'-'9'
573: \u00a0-\u00ff
574: \u0100-\U0010ffff
575: 'A'-'Z'
576: 'a'-'z'
577: '0'-'9'
578: \u0100-\U0010ffff
579: .
*/
